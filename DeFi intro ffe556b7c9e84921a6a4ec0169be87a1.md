# DeFi intro.

DeFi i试图对银行系统的三个关键部分进行优化：

1. (**Payment and Clearance System**) 支付 & 清算系统（汇款）
    
    降低交易费率和交易时间    跨国汇款：通常需要几个工作日才能完成 ，而且会包含种类繁多的手续费 。更糟糕的是，还可能存在与汇款所需证明文件、反洗钱法律 的遵守、隐私等相关的问题。你的银行汇率，国际电汇汇出手续费以及国际电 汇汇入手续费
    
2. (**Accessibility**)可获取性
    
    ( 访问 DeFi Dapp (去中心化金融应用程序) 只需要用户拥有一部接入互联网的手机，而不需要经过冗长的验证流程。）DeFi代表着一场旨在推行无国界、无审查、无障碍金融产品的运动。DeFi 协议不会歧视任何人，而且会为每个人营造公平的参与环境。这些人甚至没有最基本的储蓄账户。
    
    世界银行估计，截至2017年，有17亿人没有在金融机构处持有 账户，其中一半以上来自发展中国家 3 。他们主要来自于贫困家 庭，他们没有银行账户的主要原因包括贫困、地理位置和信任 上的问题。
    
3. (**Centralization & Transparency**) 中心化 & 透明度
    
    银行是导致金融体系崩溃的中心节点之一 2008年，存款超过1880亿美元 5 的华 盛顿互惠银行（Washington Mutual）和资产超过6390亿美元 6 的雷曼兄弟（Lehman Brothers）双双倒闭。仅在美国，就拥有 超过500家银行倒闭的记录
    
    透明度也与此紧密相关——普通投资者无法充分了解金融机构 的运作。
    
    DeFi协议大都是开源的，便于审计和提升透明度。这些协议通常会有去中心化的治理组织来确保每个人都清楚发生了什么 ，并确保没有恶意行为者能够单独地做出恶意决策。归根到底，DeFi 的最大优势在于能够消除中介机构并在零审查 (zero censorship) 的环境下运行。
    

去中心化金融或 DeFi 是一种允许用户在无需依赖中心化实体的情况下利用借贷和交易等金融服务的运动。这些金融服务是通过去中心化应用程序（Dapps）提供的，其中大部分部署在**以太坊**平台上。

目前，大多数 DeFi dapp 都属于半去中心化类别。

## **DeFi 的 8 大主要类别：**

### **一些名词**

Dapp：

在以太坊网路下，Dapp 是通过使用 Smart Contract 来与区块链进行交互的接口。从前端来看，Dapp的外观和操作类似于常规的Web、移动 App，只是它们是以不同的方式与区块链进行交互。

DAPP 特点：

- 不变性 **Immutability**：一旦信息保存在区块链上，任何人都不能更改；（缺点： 而不可变的智能合约有可能会将错误放大；）
- 防篡改 **Tamper-proof**：发布在区块链上的智能合约不能在区块链上的其它参与者不知情的情况下被篡改；
- 透明性 **Transparent** ：智能合约驱动的 Dapp 是公开可审计的；（缺点： 黑客可以通过查看代码来发现合约漏洞；）
- 可用性 **Availability**：只要以太坊网络保持 active，在其之上搭建的 Dapp 将保持 active。
- 扩展性不足 **Scalability**：在大多数情况下，Dapp 的带宽受限于其所在的区块链。

DAO：

DAO是一个完全自治的组织，**它不由个体管理，而是通过代码进行 管理**。代码是基于  Smart Contract  运行，使得 DAO 能够取代传统机构的典型运作模式。它将免受人为干预、透明地运行。DAO的管理决策或裁决将会通过DAO 代币投票(相对)民主决定。

ETH ：

以太坊可以用作一个创建其它加密货币的平台。目前， 以太坊网络上有两种流行的代币协议：**ERC-20** 和 **ERC-721**。ERC-20 是一个协议标准，其定义了在以太坊上发行代币的规则和标准。

- ERC-20 代币是可互换代币，意味着代币间是可互换的并具有相同的价值。（ERC-20标准 Token 在价值上没有差别，故不再适用于需要独特属性的资产，比如加密的收藏品和游戏道具。）
- ERC-721代币是不可互换代币，意味着代币是唯 一的且不可互换的。

用一个例子说明：

如果在区块链有一个虚拟宠物应用程序，里面有100只猫。

如果这个应用的 Token 是基于ERC-20标准开发的，我们同时都有一只猫，那么你的猫和我的猫是一样的，都是一个 Token ，而且"猫" 的 Token 是可以分的。例如，如果它被分成10 个副本，那么每个副本都是 0.1 Token。

如果这个应用的 Token 是基于ERC-721标准开发的，那么反正你的猫和我的(价值)不一样，因为我们的猫 ID 是不一样的，猫作为一个整体是不可分割的，是唯一的。

在这个例子中，我们可以看到ERC20令牌和ERC721令牌之间的两个区别:

1. ERC-20标准的令牌没有价值区分，可以互换；ERC-721标准中的令牌不可互换，每个令牌都有唯一的标识。
2. ERC-20标准的令牌是可以划分的，而ERC-721标准的令牌是不能划分的。
    
    这是因为两个标准之间的差异，它们可以应用于不同的场景。事实上，ERC 还有 ERC233,ERC777等标准。
    

Wallet（托管与非托管，Custodial vs Non-Custodial）

托管钱包是**第三方**代表您保留并保持对您的加密货币的控制权的钱包。非托管钱包是您完全控制和拥有您的加密货币的钱包。这类似于区块链行业许多人信奉的“做自己的银行”的口头禅。

通过使用托管钱包，您信任外部方来安全地存储您的硬币。这可能很方便，因为您无需担心私钥安全性，但您只需担心帐户凭据安全性。但是，通过将您的加密货币 (私钥) 委托给第三方，您将面临托管人因管理不善或黑客行为而丢失您的加密货币的风险。有许多托管钱包丢失加密货币的事件，最突出的例子是 Mt. Gox 在 2014 年损失了超过 850,000 比特币，价值超过 4.5 亿美元。

通过使用非托管钱包，您不信任任何外部方，只信任您自己来确保您的加密货币是安全的。但是，通过使用非托管钱包，您将安全负担转嫁给自己，并且您必须完全具备安全存储私钥的能力。如果您丢失了您的私钥，您也将无法访问您的加密货币。

**MetaMask** 是非托管钱包（non-custodial ），作为交互桥梁（interaction bridge），Metamask 使您能够使用托管在以太坊网络上的所有去中心化应用程序（Dapps）。

如果不使用 MetaMask 之类的交互桥，您的浏览器将无法访问以太坊区块链，除非您正在运行完整的以太坊节点并且在您的计算机上下载了超过 400GB 的整个以太坊区块链。

在技术层面上，MetaMask 通过将由核心以太坊开发人员编写的名为 web3.js 的 JavaScript 库注入到您的浏览器页面中，使您能够轻松地与以太坊网络进行交互。

Metamask 让您在笔记本电脑或 PC 上与以太坊网络上的 DeFi Dapp 交互非常方便。 它们在某种程度上是安全的，因为它要求您**签署您在网络上执行的每个交互和交易**。

### **Stablecoins (稳定币)**

众所周知，加密货币的价格非常不稳定。加密货币的盘中波动超过 10% 是很常见的。为了减轻这种波动性，创建了与美元等其他稳定资产挂钩的稳定币。帮助用户对冲这种价格波动（hedge against this price volatility）

例如，波动性上升时，传统投资者会选择把部分投资组合分配到现金或国债，而加密货币投资者则转向稳定币。

Tether（USDT，泰达币）是最早引入的中心化稳定币之一。每个 USDT 都和 1 美元对应—— USDT 的主要缺点就是用户需要相信美元储备是完全抵押的（collateralized）并且确实存在（只要储备资产不低于发行的稳定币，就能100%稳定。）。

虽然稳定币本身并不是真正的金融应用程序，但它们通过稳定的价值存储让每个人都可以更容易地使用 DeFi 应用程序。

有两种类型的挂钩，即 法定抵押 和 加密抵押。 大多数稳定币采用**法定抵押**系统来维持与美元挂钩。

### **Tether (USDT)**

Tether (USDT) 通过维持每个铸造的 Tether 代币 1 美元的储备金将自己与 1 美元挂钩。

Tether这家私人公司，他们发行的稳定币叫USDT（T就是Tether的首字母）. Tether最大的风险在于该公司注册在某个小岛上，财务极度不透明，无审计，是否能100%兑付已发行的USDT大家心里是没谱的。

除了USDT外，USDC和GUSD等稳定币是由受监管的美国公司发行，审计相对透明。

Tether 储备金保存在金融机构中，用户必须信任 Tether 作为一个实体才行。因此，Tether 是一种**中心化的、法定抵押**的稳定币。

### ****

### **DAI**

Dai (DAI) 使用以太坊 (ETH) 等加密货币进行抵押。它的价值通过 DAO 和智能合约投票选出的协议（protocols）与 1 美元挂钩。在任何给定时间，用户都可以轻松验证生成 DAI 的抵押品。 DAI 是一种**去中心化、加密抵押**的稳定币。

DAI 不是上述的 1:1刚兑发行制，而是**抵押发行制**，由[MakerDAO](https://makerdao.com/)首创。MakerDAO自身没有任何资产储备，它仅仅在链上创建了几个抵押合约，来实现稳定币的发行。

首先，MakerDAO 挑选几个市值巨大，流动性也非常高的币种作为抵押物，例如BTC，ETH等，用户可以将自己手里的这些资产抵押到合约，并获得一个抵押凭证。

然后，根据市场当前价格，用户可以按一个比例，例如 50%，**用抵押物发行稳定币DAI**。当DAI发行出来后，抵押物就无法被用户取出，除非偿还了对应数额的DAI。如果遇到抵押物价格大幅下滑，快接近发行额度时，会触发清算机制，MakerDAO的合约会卖出抵押物，防止发行的DAI资不抵债。

所以，DAI是一种以链上资产作为**超额抵押**的稳定币，只要**充当抵押的资产价格不会大幅下跌至平仓线，这种稳定币就能1:1锚定美元**。

DAI 是 DeFi 生态系统中使用最广泛的原生稳定币。它是用于 DeFi 交易、借贷等的首选美元稳定币。

> <Maker> 介绍—— P45
> 

### **TerraUSD(UST)、Terra (LUNA)**

Terra是一种使用 Cosmos SDK 创建的区块链网络，致力于创建稳定币。Terra稳定币不使用法币或超额抵押的加密货币作为储备，而是转换为该网络的原生代币LUNA。

为了与 TerraUSD(UST) 这样的稳定币挂钩，LUNA的美元价值可按 1:1 比例与 UST 代币兑换。例如，UST 的价格是 0.98 美元，套利者用1枚 UST 换取1美元来赚取2美分差价。这种机制增加了UST的需求量，同时减少其供应量，因为UST会被销毁。然后，稳定币就会回到挂钩状态。

当UST的价值高于1美元，假设为1.02美元，套利者可将1美元LUNA转换为1枚UST来赚取2美分。UST供应量提升，需求量减少，价格回到挂钩状态。

除了降低稳定币的波动程度，验证者与委托人还通过质押 LUNA 来获取奖励。这两个角色对维护网络安全与确认交易至关重要。

可通过币安购买LUNA，然后使用Terra Station（Terra区块链网络的官方钱包和操作面板）存储、质押并参与治理。

> Terra是区块链平台，用户可在该平台创建与法币挂钩的 稳定币。这些代币主要利用Terra网络的铸币税机制。Terra由Terraform实验室的Do Kwon和Daniel Shin于2018年共同创立，使用Tendermint委托权益证明(DPoS)作为共识机制。Terra具备智能合约功能，可创建各种不同类型的稳定币。
> 

Terra是亚洲最大的稳定币项目，起初专注于亚洲的电商支付领域。它是基于Cosmos框架搭建的一个区块链协议，是一条单独的链，在这条链上Terra 开发搭建了一个稳定币网络，发行了多种法定货币的锚定币。Terra 发行的稳定币是算法稳定币，在进行跨境支付时提供更多的稳定性。这些稳定币背后并没有BTC、ETH 或者美元类似的支撑资产，而是由 Terra 的原生代币 LUNA 进行背书。通过使用稳定币，Terra加密货币生态系统提供低费用、即时结算和无摩擦的跨境价值交换，为零售交易提供动力。

Terra的许多商户合作伙伴和客户通过Terra的专有钱包Terra Station直接访问Terra区块链网络。Terra Station支持Terra的定额实用代币LUNA和所有Terra稳定币，以及锚定协议（ANC）和镜像协议代币（MIR）。Terra Station还支持所有其他Terra生态系统的资产。Terra钱包还允许用户与建立在平台上的众多基于Terra的去中心化应用程序（dApps）互动，以交换代币，将LUNA委托给验证者，并管理资金，以及其他目的。

为了更好的理解 Terra 的算稳工作模式，我们以 TerraKRW 举例：

> 当 1 枚 KRT 价格 < 1KRW（韩元），矿工向系统发送一枚 KRT 并获得与 1 KRW 等值的 Luna 代币，此时系统的 KRT 供应量减少、价格上升逐渐趋近等值韩元；
> 
> 
> 当 1 枚 KRT 价格 > 1 KRW（韩元），矿工向系统发送与 1 KRW 等值的 Luna 代币并获得 1 KRT，此时系统的 KRT 供应量增加、价格下降，逐渐趋近等值韩元。
> 

从这里我们可以非常清楚的看到 LUNA 的重要性，那它本身是如何达到这种弹性并完全吸收市场的短期波动的呢？

LUNA的主要功能是通过锁定Terra生态系统内的价值来保护Terra机制的完整性。Terra协议在权益证明（PoS）区块链上运行，矿工（验证者）需要用原生加密货币 **LUNA 来挖掘 Terra 交易**。委托机制允许任何想要支持Terra网络并赚取质押奖励的人委托给选定的验证者。质押奖励首先分配给验证者，验证者为提供他们的业务收取佣金，然后由委托者单独提取。Terra 内发生的每笔交易将会被收取 0.1% 到 1% 的费用，上限为 1 TerraSDR，费用将分配给参与 Staking 的用户。奖励会随着交易量的增加而增加。

矿工将在每个区块[约7秒]获得报酬。并可以在Terra Station的Staking标签上直接查看所收获的奖励。所有的奖励在提取后都可以使用，

当整个Terra的大型支付服务供应商网络的交易量增加时，对TerraUSD（和其他稳定币，如TerraJPY、TerraGBP、TerraCNY）的整体需求就会扩大，参与 LUNA 质押的矿工就能赚取更多的收益，从而吸引更多的用户参与其中，产生近乎永动机的良性循环。

Terra 项目主要代币是 UST 和 LUNA ，前者目标是被最广泛使用，后者负责提供保障。一开始UST 和LUNA价格为1美元。当UST高于1美元，系统销毁LUNA创建更多UST，使UST下跌，这时由于LUNA被销毁，拉动LUNA上涨。当UST低于1美元，则烧UST造LUNA，LUNA价格会下降。

每次燃烧，系统都会收取费用，这部分费用给坚定的LUNA 质押者，费用以 UST 支付的，当UST涨而LUNA跌，大量燃烧会使质押者收益猛升。这甚至使得 luna能对抗熊市（后述）。这一点和其他质押项目不同，如CAKE 年化很高，但收益就是通胀，所以你币多了，可能价格也跌了；价格跌了你的收益更少了。

目前最成功的支付应用Chai 支持 Terra，它获得了来自软银等公司的7500万美元投资，目前很多企业使用，总交易额相比传统渠道还有很大空间。最酷的是Terra能够接受任何法币的付款，链上转换成UST，再以当地货币转给商家——全球化稳定币！

UST 是一种与美元挂钩的算法稳定币。为了铸造 UST，用户必须销毁同等价值的 LUNA （也即 1：1）；类似地，为了赎回 LUNA，用户将必须销毁同等价值的 UST。这意味着 UST 没有外部抵押品资产的支持，而是依靠市场激励来维持稳定。

> 假设 UST 的价格是 1.01 美元，也即高于 1 美元的锚定价格。这意味着对 UST 稳定币的需求超过了供应。在这种情况下，为了降低 UST 的价格，套利者会被激励销毁 1 美元的 LUNA 来铸造新的 UST，从而捕获 UST 的目标锚定价格 （即 1 美元） 与当前的价格 （即 1.01 美元） 之间的 0.01 美元的差额带来的收益。
> 
> 
> 当 UST 的交易低于 1 美元的锚定价格时，也存在类似的套利机会，这意味着 UST 稳定币的供应超过了需求。如果 UST 的价格是 0.99 美元，套利者就会被激励销毁 UST 来铸造 1 美元的 LUNA，并将差额收入自己腰包。这将减少 UST 的供应，从而帮助 UST 的价格提高到 1 美元的锚定价格，。
> 

虽然这一机制相对简单，但迄今为止已被证明在扩大 UST 供应方面非常有效。

UST 的资本效率非常高，因为它不需要任何抵押品支持来铸造新的 UST，与其他稳定币设计 （比如超额抵押的稳定币） 相比，这种机制增加了 UST 在供应增长方面的便利性。像 DAI 这样基于超额抵押的稳定币，其供应增长依赖于人们债务需求的增长。UST 的这种机制也被证明在很大程度上有效地保持了 UST 的价格维持在其锚定价格附近，因为自 2021 年 5 月崩盘后以来，该协议的波动幅度从未超过 0.02 美元。

### **算法稳定币的问题：**

> 到目前为止，各类算法稳定币还没有一个能获得成功。虽然算法背后的数学公式被论证得无懈可击，但现实世界的运行方式显然与数学公式不同。深究其原因，实际上任何一个货币系统想要稳定，都需要外部源源不断地为其注入资源，无论这种资源是财富还是大炮，凭空印钞总会印成津巴布韦元。而算法稳定币价格在水下时，试图利用人的套利行为将其拉上来事实上很难行得通，因为小规模套利有可能，把整个货币体系从水下套利到水面必须让所有人达成一致共识，这是不可能的。
> 

### **Lending and Borrowing**

传统金融要求用户拥有银行账户 (Account) 才能被服务，这是目前 17 亿人所没有的奢侈品。 从银行借款还需要有良好的信用、足够的抵押品以使银行相信其信誉——能够偿还贷款。

去中心化借贷——允许任何人抵押他们的**数字资产**并使用它来获得贷款。 人们还可以通过为借贷池做出贡献并从这些资产中赚取利息来赚取资产收益并参与借贷市场。 通过去中心化借贷，不需要银行账户或信用检查。

我们将探索这种无银行借贷机制如何通过 Compound Finance（一种 Defi 借贷协议）实现。

三种主要形式：

- 点对点撮合：代表项目是 Dharma，由 Smart Contract 充当“担保方”角色，评估借款人的资产价格和风险，债权人只需要根据“担保方”提供的评估结果决定是否贷款给借款人，同时当借款人无法按时还款时，“担保方”就会自动执行清算程序。
- 稳定币：典型模式是 MakerDAO，在这个模式里，没有出借方，只有借款人，唯一可借入的资产是MakerDAO 平台发行与美元挂钩的稳定币DAI ，DAI 是由借款人通过抵押 ETH 借入而新创造的，质押资产和借款的质押比率必须保持在 150% 以上。 比如你质押 150 个 ETH，能借到价值为 100 ETH 的 DAI 币。 其中的利息是由治理币 MKR 的持有者通过**投票**来决定的，是不固定的
- 流动池交易：代表是 Compound，借方和贷方通过流动性交易池进行借贷，而不是与交易对手匹配。每个贷款和借款的利率由池子的流动性（借方提供的货币总量和借款人的需求总量的比率）决定。整体借贷效率高于点对点。

这三种形式相比传统金融有了巨大的创新。

### **Compound**

How much interest will you receive, or pay?

一般来说，借贷需求越高，利率 (Annual Percentage Yield，APY)  就越高，反之则越低。

> 以 DAI 稳定币为例，贷方将在一年内赚取 7.58%（截至 2020 年 2 月），而借款人将在一年后支付 8.00% 的利息。
> 

### **抵押资产的价格变动（collateral asset）**

1. 抵押品价值上升：
如果您用作抵押品的资产价值上升，您的抵押率也上升了，这很好——什么都不会发生，如果你愿意，你可以提取更大的贷款。
2. 抵押品价值下降：
另一方面，如果抵押品下跌，您的抵押品比率现在低于要求的抵押品比率，您的抵押品将被部分出售以及 5% 的清算费用。 出售您的抵押品以达到最低抵押品比率的过程称为清算（Liquidation）。

### **Decentralized exchange（DEX）**

DEX 即去中心化交易所，可以将一种加密货币兑换成另一种。

货币兑换可以使用 Coinbase 或 Binance 币安 等交易所。 像这样的交易所是**中心化交易所**（CEX），这意味着它们既是交易资产的中介机构又是托管人（custodians）。 这些交易所的用户无法完全控制他们的资产，如果交易所被黑客入侵，他们的资产就会面临风险（2019 年，价值超过 2.9 亿美元的加密货币被盗，超过 500,000 条登录信息从某交易所泄露。）

越来越多的人意识到这些风险并转向DEX，Decentralized exchanges。 DEX 旨在通过允许用户在不放弃其**代币保管权**（custody of their coins ）的情况下交换加密货币来解决此问题。 无需在中心化交易所存储任何资金，用户无需信任交易所即可保持偿付能力。

它不将用户资金和个人数据存储在服务器上，而只是作为一种基础设施来匹配希望买卖数字资产的买家和卖家。在匹配引擎的帮助下，这种交易直接发生在参与者(点对点)之间。

DEX 通过使用智能合约和链上交易来减少或消除对中介的需求。一些流行的去中心化交易所包括 Kyber Network、Uniswap、Dex Blue 和 dYdX 等项目。

### **DEX 交易过程**

> 以CoinDEX交易所为例
> 
1. 在CoinDEX上，用户创建好地址后，私钥自持，平台方无权限也无能力获取用户私钥。
2. 通过授权智能合约，进行订单提交，提交的订单将会汇集到 CoinDEX 的订单池中，以供其他用户查看。
3. 当其他用户找对价格适合的订单后，可以选择执行该订单，提交到CoinDEX的服务端，确认无误后，相关交易信息将会进行上链，整个交易流程通过智能合约完成。
4. 订单池到用户执行订单通过 P2P 通信，最后提交到服务端，链下执行订单。最后一部执行是上链操作，上链成功后，将会由系统通知用户该笔订单已完成的信息。

总结下优缺点：

1. 在 DEX 平台中，用户的资产不是由平台方来管存，而是由智能合约来管理。交易时平台方不触碰用户资产，用户的资产也无需充值到平台中，用户的交易操作都是点对点的交易，订单操作需要交易者用私钥签名，撮合成功后通过智能合约验证，资产直接到账钱包，无需提现，平台只负责交易流动。
2. 在 CEX 中，由于交易数据不上链，所以只要有匹配的对手单，成交速度极快；DEX则是完全由区块链支持的，每一个交易订单，每一个状态的变化都将作为交易记录在区块链网络中，往往会导致流动性差、成本高、速度慢等问题。（ 底层公链的性能严重制约DEX的发展，导致用户体验远低于CEX ）

### **Automated Market Maker Mechanism (AMM)**

AMM 即 “自动做市商” 机制。

假设 DEX 只提供一种服务：代币 A 与 B 的相互兑换，在设计做市方式时希望能够实现：

- 随时为用户达成双向交易（A 换 B 或 B 换 A ），并且兑换价格总能跟随当前市场真实价格
- 部署完成后无须额外人为维护，能够稳定自主运行
- 由于链上行为运行智能合约时，每一行代码每一个操作都具有成本（gas费用），所以该方式应当尽可能地简单。

满足上述条件的做市方法——AMM，最早被Uniswap提出并应用，截止目前已经被推广并迭代了多个版本，接下来将详细介绍AMM的原理。

**价格预言（Price Oracle）与恒定乘积做市商CPMM**

说到代币 A 与 B 的相互兑换，最重要的当然是价格。我们假设当前市场交易方式 A 与 B 为 1:3 ，即1个A可以兑换3个B，那么 DEX 应该如何让兑换价格维持与市场价相同？在诸多链上活动中，**获得当前市场价格**这一行为被称为**价格预言**，某些去中心化应用（dapp）通过调用公开的价格预言机接口获得实时市场价，但这不是本文的重点，暂时按下不表，AMM 则是通过**资金池+价格曲线**的方式维持兑换价格的，是一种被动方式，简单有效且不依赖额外的操作与接口，但也因此带来不少问题，稍后会进一步介绍。

资金池+价格曲线是一种基于反比例函数也就是 `k=a*b` 作为价格曲线的资金池模式，其中 `a` 和 `b` 分别是池中代币数量，k 是一个**常数**，所以这种方法又被称为恒定乘积做市商 CPMM 。

![https://pic2.zhimg.com/v2-9f62bf43f0ee5ab66df588b9a98a6e3d_b.jpg](https://pic2.zhimg.com/v2-9f62bf43f0ee5ab66df588b9a98a6e3d_b.jpg)

可能有人会觉得疑惑这种资金池代币数量乘积的方式怎么可能维持兑换价格跟随市场价？通过具体例子我们可以看到该机制的运行方式。

首先对于 AMM 而言，它的兑换价格是根据资金池中两种代币的数量比决定的，假设 A 与 B 的兑换比是   1 : 3  ，1 个A代币 能兑换 3 个 B代币，则  k=a*b=27 。

如果忽然市场价格改变了，大市场上 A：B 的兑换比变为了

[https://www.zhihu.com/equation?tex=1%3A2](https://www.zhihu.com/equation?tex=1%3A2)

，但在发生交易前， DEX 的反应是滞后的，仍然是  1:3   ，所以立即会有

**套利交易者**

（术语称为Arbitrager，通过在价格不一致的市场中交易从而无风险套取利润的交易者，俗称搬砖人) 发现在这个 DEX  的 B 代币更便宜，于是在该资金池用 A 兑换 B，并到别的市场换回 A 实现套利。

回顾一下，此时资金池里有 a=3 个 A 代币， b=9 个 B 代币，则  k=a*b=27  。

大市场上 A：B 的兑换比变为了 1:2 , B 变贵了，一位 Arbitrager 决定拿出 0.5 个 A 代币进行换 B，那么本 DEX 应该给他多少个 B 币？

a = 3.5, b=k/a = 7.71428

则他得到B :  \Delta b =  9 - 7.71428 = 1.28572

注意到，这一兑换价格  0.5 : 1.28572= 1 : 2.57  与虽然比市场价  1:2  依然划算，但和 DEX 标榜的  1:3  兑换比存在差异，这其间的差额则被称为滑点（Slippage），产生的原因是相比于兑换额度，资金池容量太小，占比达 0.5/3=16.67%。当兑换额度相对资金池容量很小时，滑点会相对小很多，滑点的存在是AMM的主要局限性之一。

兑换后池中  a=3.5，b=7.71428 ，则此时兑换价变为  1 : 2.2 ，依然比市场价划算，于是会有新的套利交易者进行交易，只要 dex 价格与市场价有差异，那么就有套利空间，所以直到资金池满足  a:b 和市场价持平，且始终有 k=a*b。以上便是AMM兑换价格能始终跟踪保持市场价的原因。

> 在新增或减少资金池量时，需要对 k 值 ( k=a*b) 进行改变
> 

恒定乘积做市商CPMM的价格曲线非常简单，计算过程也不复杂，早期 Uniswap 所部署的AMM仅使用大约300行代码。

总体来看AMM似乎did a really good job，但它依然存在许多局限性:

**1 / 暂时性亏损（Impermanent Loss ，IL）**

用户向AMM池提供流动性的主要风险（也是最不为人所知的风险）是暂时性亏损——在AMM中存入代币与仅仅在钱包中持有这些代币之间的价值差异。当AMM内的代币的市场价格在任何方向上发生偏离时，就会产生这种损失。由于AMM不会自动调整汇率，因此套利者需要买入价格偏低的资产或卖出价格偏高的资产，直到AMM提供的价格与外部市场的市场价格相匹配。套利者获取的利润是从流动性提供者的口袋里抽走的，这将对流动性提供者造成损失。

2 / **资本效率低下**

根据上文的介绍，为了维持较低的滑点，资金池量需要比交易额大得多，特别是涉及主流币的资金池，这意味着dex背后的资金池中存在大量并没有真正用来被交易的代币，相比于实际交易量的几十甚至上百倍。

### **Derivatives 衍生品**

Derivatives 是一种合约 contract，其价值来自另一种标的资产，例如股票、商品、货币、指数、债券或利率。

交易者可以使用衍生品对冲（hedge their positions）并降低特定交易的风险。 例如，假设您是一家手套制造商，并且想要对冲橡胶价格意外上涨的风险。 您可以从您的供应商处购买一份期货合约，以便在特定的未来交割日期以今天的约定价格交割特定数量的橡胶。

再举一个例子：

Mr.Bean是一个农民，他种玉米。如果玉米的市场价格很低，那么他就会有损失，因为无法高价卖出玉米。

Mr.Merchant是一个做玉米粉的公司经理，他需要从农民手中购买玉米并加工成产品。所以，相反地，当玉米的市场价格很高时，他会有损失。

因为 Mr.Bean 和 Mr.Merchant 的期望的价格是相反的，所以，我们让他们俩个签一个合约，合约上说：如果在未来，比如 2022.5.21 日，Mr.Bean 会以 300元/斤的价格卖出自己的玉米，同时，Mr.Merchant会以300元/斤的价格买入农民的玉米，这个合约就叫做**forward，即[远期合约](https://www.zhihu.com/search?q=%E8%BF%9C%E6%9C%9F%E5%90%88%E7%BA%A6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={%22sourceType%22%3A%22article%22%2C%22sourceId%22%3A%22376225566%22})，是derivative的一种形式。**

因为价格的不确定性，农民和公司都会面临一定的风险，那么两者签订这种合约**共同分担这个风险(share the risk)**，这种分担风险的方式就叫做**hedging(对冲风险)。**

在金融领域，衍生产品的官方定义是这样的：

> 衍生产品 (Derivative Products)，是指从传统的基础金融工具，如货币、利率、股票等交易过程中，衍生发展出来的新金融产品，形式有远期(forward)、期货(future)、期权(option)和掉期(Swap)等。
> 

**衍生产品是一种金融工具。金融市场风险很大，所以它这个工具最大的作用就是对冲风险。**(当然还有其他的作用比如套利arbitrage，简单来说就是赚价格的差价；投机speculation等等)

**衍生产品的价值依赖于其他标的资产(underlying asset)的价格。**

之后我们将深入探讨最大的 DeFi 衍生协议 **Synthetix**。

### **Synthetix**

这个产品可以说是所有做股票期权、外汇、期货、贵金属、大宗。。。。平台的升级版，是你在过去十几二十年听过的所有金融交易平台的跨纬度降维打击版。

**Synthetix是做什么的呢？合成资产交易**

一句话来说，合成资产是模拟了其他资产的价格，让人们可以直接在区块链上进行交易。

在传统的资产交易市场，我们可以买卖股票、房地产、贵金属或者大宗商品。然而在 DeFi 的世界发展的现有阶段，我们并没有直接的方式去交易股票、贵金属、大宗商品等资产，怎么办？

这时候，就有项目方提出了合成资产的概念：**如同传统金融市场上的衍生品，是否可以锚定这些交易对象，创建一类虚拟资产，可以直接在区块链上表示这些传统的交易市场，去复制他们的价格，从而实现链上交易？这就是合成资产的由来。**

合成资产 (Synths)，就是对目标资产的镜像模拟。例如，用 sUSD 去表示美元的价格，用 sGold 表示黄金价格，用 sSP500 来表征标普 500 股票指数等。甚至，加密资产本身，也可以成为锚定物，用 sBTC 来表示 BTC，用 sETH 来表示 ETH。但是并不能够将黄金的合成资产（如 sGold) 一比一兑换为黄金实物。

**合成资产的创建**

> 实际上，Synthetix 并不能让用户直接创建全部的合成资产类型，而是分为两步：
> 
- 通过 Mintr 平台 ([https://mintr.synthetix.io/](https://link.zhihu.com/?target=https%3A//mintr.synthetix.io/)), 用户超额抵押 Synthetix 平台代币 --- SNX (Synthetix Network Token) 作为担保物，能够铸造出 sUSD 稳定币。目前的标准抵押率是 700%， 也就是说抵押7 美元价值的 SNX，才能创建1 美元的 sUSD。这么设计是因为，毕竟 SNX 没有那么强的价值共识，设置高额抵押率，降低抵押物价值不足的风险。
- 使用铸造出来的 sUSD 稳定币，在Synthetix 的交易平台(Synthetix.exchange) 上，交易合成资产。事实上 sUSD 购买合成资产的过程，也是这类合成资产铸造的过程。此时销毁了 sUSD，创建了对应的合成资产。

**债务计算**

Synthetix 最让人费解的地方在于，采用了动态的债务计算方式，而通常我们所见到的稳定币项目中，采用的是静态债务计算。简单解释一下：

在 MakerDAO 之类的稳定币项目中，如果你抵押了 ETH 作为担保物，创建了 10 美元价值的稳定币 Dai，那么只要不爆仓的情况下，你随时还回去 10 美元的稳定币 ，即可取回担保物（此处暂且可以忽略铸币手续费）。

然而在 Synthetix 之中，随着用户持有的合成资产的价值增长时，债务水平也会随之上涨！这是最让人困惑的地方了。 怎么理解呢？

例如用户小白抵押 SNX，创建了 100 sUSD，这 100个 sUSD，是小白从系统中借出来的资产，也就是他目前欠了 Synthetix 系统 100 sUSD 的债务。这个系统之中，可并非小白这一个用户。此时小白的债务比例，假设是 1%。

然而债务并非固定的，债务的总值，会随着系统中合成资产的价值增长而上升。假设，sBTC/sETH/sEOS 等全部的合成资产的总价值上涨了 100%， 根据平台设定，债务总值也会上涨 100%。

小白原先的债务是 100 sUSD，此时债务却也随之翻了一倍，变成了 200 sSUD！也就是说，如果小白想要拿回来原先抵押的 SNX，他需要还回去 200 sUSD 才行。

**为什么会出现这种情况？因为 Synthetix 并没有爆仓一说，对于所有的债务持有人而言，这是一个零和博弈的市场。**

前面例子中，小白选择铸币之后，持有 100 sSUD 的资产；另外一位用户老九，却会因为将铸造之后的 sUSD 兑换为合成资产 sBTC，随着 BTC 价格上涨，他的资产增值，跑赢了市场。如果市场中只存在老九和小白这两位用户的话，那么小白的亏损，就构成了老九的盈利。

**这或许是 Synthetix 在合成资产持仓上的风险之一：如果你的债务持仓没有跑赢市场，那么你就要为自己的落后表现买单了。**

**销毁 sUSD，解锁抵押物 SNX**

取回抵押物的 SNX，就需要销毁 sUSD，这一步操作比较直观，按照系统提示操作即可。

**问题来了：为什么人们会去抵押 SNX?**

Synthetix 官方介绍是，抵押 SNX 可以帮用户得到两种奖励：

- SNX 代币增发奖励。SNX 用增发的代币奖励参与抵押的用户，每周可以领取一次。
- 合成资产的交易奖励。Synthetix 交易平台上，会收取 0.3% 的交易手续费，这部分交易手续费，会按比例分给 SNX 的抵押者。

不过除了这两种奖励之外，还有另一种奖励：LP流动性奖励。例如在抵押 SNX 生成 sUSD 之后，用户可以通过 Synthetix 平台购买 sETH。这部分 sETH，可以加入到 Uniswap 等流通池中的 sETH/ETH 的交易池，享受到流动性奖励。通过这种方式，Synthetix 借助于外在的流动池，为自己提供了流动渠道，让 sETH/ETH 的价格保持锚定。

Synthetix  为 DeFi 世界带来了合成资产的新玩法，提供了铸造、交易、头寸管理的完整产品。流畅的交易体验、设计精妙的代币经济机制，以及开创的合成资产的链上交易玩法皆可圈可点，SNX 代币的价格趋势，也反映了社区对这一项目的热忱。

不过，最容易引起用户误解的是 Synthetix 的债务计算方式，一不留神，就容易中招。关键是将 Synthetix 的抵押品作为零和博弈市场来看待，理解动态债务计算跟静态债务计算两种不同的方式，会帮你避开一些坑。

**而且 Synthetix 和许多 DeFi 项目一样，仍然需要应对预言机失效、智能合约故障、黑客攻击 等风险。**同时，使用自身平台代币 SNX 作为抵押品、设置了高抵押率、复杂的项目设计尤其是债务计算的设计方式，以及缺少清算机制，也会为 Synthetix 带来影响。

**无论参与 Synthetix 还是其他的 DeFi 项目，仍然要明白风险存在的必然性，做好必要的风险防范再去参与。**

### **Fund Management 基金**

基金管理是监督你的资产并管理其现金流以产生投资回报的过程。基金管理主要有两种类型：主动基金管理和被动基金管理。

- 主动基金管理公司的管理团队做出投资决策，以超越标准普尔500指数等特定基准。
- 被动基金管理公司没有管理团队，其设计方式是尽可能模仿特定 benchmark 的表现。

在 DeFi，一些项目已经开始允许以分散的方式进行被动资金管理。DeFi 的透明度让用户能够轻松跟踪资金的管理情况，了解他们将支付的成本。

### **TokenSets**

TokenSets 是一款加密资产投资组合的自动化管理平台，旨在为投资者提供捕捉加密货币波动性的交易策略，基于Set Protocol 开发而成。

Set Protocol 是去中心化的加密资产投资组合创建和管理协议，致力于打造以智能合约实现一揽子代币抽象化的金融基础设施服务。Set Protocol 目前已推出了专注 DeFi 领域的 Set V2 版本，增加了对 DeFi 代币、稳定币、合成资产等多种资产支持，并支持了流动性挖矿。

目前，TokenSets 提供“ Portfolios”“ Set社交交易”和“ Robo组合”三类，数量超过60种的不同的交易策略，更多资产组合持续开放中。

比如选择一个 ETH 20 Day Moving Average Crossover Set Details（ETH 20天移动平均交叉集详情）策略：

ETH 20天移动平均交叉集在ETH 20天简单移动平均指标上实施交叉策略。

![https://www.blockvalue.com/uploads/autoimage5/2020021220-e3f45a28453bbbbf3fdd75be34b09d3c_GI2DAMBKGEZTEMA.png](https://www.blockvalue.com/uploads/autoimage5/2020021220-e3f45a28453bbbbf3fdd75be34b09d3c_GI2DAMBKGEZTEMA.png)

上图中，行情从低位起步的时候，左边的红色椭圆内1号点，就是一个相当于炒股时的买入信号，系统自动将你的稳定币USDC转换成ETH，而随着行情上涨你就赚钱了，当行情下跌的时候，如上图右边的红椭圆内2号点，就是一个卖出信号，系统自动将你的ETH出售转换成USDC，减少进一步下跌的风险，稳固收益。

为什么使用20天简单移动平均数？

20天的简单移动平均（20 SMA）是最流行的交易指标之一，以确定何时进入和退出位置在短期内。与50日均线和其他长期均线相比，20日均线跟踪短期趋势，从而产生更多信号。

我理解的这个项目就相当于一个智能合约，自动帮你按照你选择的参数标准，帮助你进行交易买卖，减少人性因子或者说交易噪音的影响。

### **Lottery 彩票**

借助 DeFi 的模块化，可以将一个简单的彩票 Dapp 链接到另一个 DeFi Dapp 并创造更多价值的东西。

比如一个例子：某 DeFi Dapp 允许参与者将他们的资金集中在一起。 然后将汇集的资金投入到 DeFi 借贷 Dapp 中，并以设定的时间间隔将所赚取的利息分配给**随机**的赢家。 一旦中奖者被选中，彩票购买者将获得他们的彩票退款，确保所有参与者都不会受到损失。这场博弈没有输家，只有机会成本( opportunity cost )。

这个概念并不新鲜，它类似于 Prize-Linked Savings Account (PLSA)，通过为幸运的获奖者提供抽奖来激励人们在银行的储蓄账户中储蓄更多。

代表产品： **PoolTogether**

通过PoolTogether协议，任何人存入DAI、USDC等代币后，协议会将所有存款都集中到一起，投入到Aave、Compound等借贷协议中，每周都会抽取一名幸运儿获得利息奖金。

所有参与者都能保留存款，并始终有权在任何时候提现。任何人都会买彩票，但没有人会失去自己的原则，对吧?
今年2月，该协议推出了原生治理代币$POOL，以及一个流动性挖矿项目。你可以想象，该协议的锁仓价值和利息都会飙升。

PoolTogether现在有超过2亿美元的存款，每周在所有池中分发近10万美元的奖金。

PoolTogether更吸引人的部分是，该协议产生现金流的方式，并能随着时间的推移自然实现其资金多样化。

**机会成本：**

如果您将资金投入 Compound 以提供流动性，您将能够从中赚取利息。

但如果您将其投入 PoolTogether，您将失去可以从 Compound 获得的利息，但有机会赢得彩票。进入彩票的“费用”实际上是你在 Compound 上借出所获得的利息。

### **Payment**

加密货币的一个关键作用是允许两方（two parties）之间**去中心化**和**去信任的**价值转移。随着 DeFi 的发展，更多有创意的支付方式正在被创新和试验。

One such DeFi project that is that 旨在通过将支付重新配置为流（as streams）而不是我们熟悉的交易（transactions）来改变我们处理支付的方式（哈？ ）。以 streams 的形式提供支付的可能性开辟了货币的大量潜在应用。想象一下“按需付费（pay-as-you-use）”，但规模要细得多，准确性更高。

虽然已经可以通过直接发送 ETH 或 DAI 来完成去中心化支付，但它仍然可以做得更好——想想更便宜、更快的交易、定时转账、按条件转账以及标准化的发票格式等等。

一些较知名的去中心化支付项目包括 Lighting Network, Request Network, xDai and Sablier.

在本章中，我们将探索 Sablier——一个我觉得很有趣的项目，它有可能为社会上的弱势群体解决一些悬而未决的问题。

Sablier 是一个支付流媒体（payment streaming ）应用程序——这意味着它允许在不同方之间以小增量（以秒为单位！）实时进行支付和取款。 考虑在工作/进度进行时实时支付的每小时咨询工作、每日合同工或每月租金支付。 就像您可以在 Spotify 上流式传输音乐一样，您也可以在 Sablier 上流式传输资金！

流支付：付款无需等待固定时间段（例如每月、每两周一次）支付，而是在双方定义和商定的时间段内实时发送。 通过 Sablier，收款人现在可以实时收到他们的工资并随时提取。

### **Insurance 保险**

由于可能的大量潜在支出，锁定在智能合约中的所有代币都可能容易受到智能合约攻击。 虽然大多数项目都对其代码库进行了审计，但我们永远不知道智能合约是否真正安全，并且总是有可能被黑客入侵而导致损失。 这些风险凸显了购买保险的必要性，尤其是当一个人在 DeFi 上处理大量资金时。

去中心化风险：

1. 技术风险：智能合约可能被黑客入侵或漏洞被利用；
2. 流动性风险：像 Compound 这样的协议可能会耗尽流动性；
3. 管理密钥风险：协议的主私钥可能被泄露。

如果在 DeFi 上处理大量资金，风险凸显了购买保险的必要性。 在本节中，我们将介绍 Nexus Mutual 和 Opyn 两大去中心化保险提供商，以帮助您保护您的 DeFi 交易。

### **DeFi Dashboard**

仪表板是一个简单的平台，可将您的所有 DeFi 活动聚合在一个地方。这是一个有用的工具，可以可视化和跟踪您的资产在不同 DeFi 协议中的位置。仪表板能够将您的资产分为不同的类别，例如存款、债务和投资。

通常，当您访问仪表板时，您需要输入您的以太坊地址（例如：0x4Cdc86fa95Ec2704f0849825f1F8b077deeD8d39）

参考资料：

1. [https://academy.binance.com/zh/articles/what-is-terra-luna](https://academy.binance.com/zh/articles/what-is-terra-luna)
2. [https://www.tuoluo.cn/article/detail-10073312.html](https://www.tuoluo.cn/article/detail-10073312.html)
3. [https://www.tuoluo.cn/article/detail-10069102.html](https://www.tuoluo.cn/article/detail-10069102.html)
4. [https://www.liaoxuefeng.com/article/1460088439046178](https://www.liaoxuefeng.com/article/1460088439046178)
5. 浅谈 DeFi 借贷 - Glaze的文章 - 知乎 [https://zhuanlan.zhihu.com/p/419629083](https://zhuanlan.zhihu.com/p/419629083)
6. 一分钟读懂DeFi| DeFi 的借贷模式有哪些？区块链科普视频 - 知乎 [https://www.zhihu.com/zvideo/1289135028752764928](https://www.zhihu.com/zvideo/1289135028752764928)
7. 5分钟带你看懂DEX与CEX的区别 - Columbu哥伦布的文章 - 知乎 [https://zhuanlan.zhihu.com/p/212198910](https://zhuanlan.zhihu.com/p/212198910)
8. 什么是自动做市商？（AMM）区块链科普｜一分钟读懂DeFi - 知乎 [https://www.zhihu.com/zvideo/1289611326428131328](https://www.zhihu.com/zvideo/1289611326428131328)
9. 你知道最近流行的AMM（自动做市商）是啥不？ - 知乎 [https://www.zhihu.com/question/406610359/answer/1335530191](https://www.zhihu.com/question/406610359/answer/1335530191)
10. [https://zhuanlan.zhihu.com/p/409074055](https://zhuanlan.zhihu.com/p/409074055)
11. 金融数学01|金融衍生品(Derivatives)简单引入--它到底是用来干啥的？ - 可口可乐了可口可乐的文章 - 知乎 [https://zhuanlan.zhihu.com/p/376225566](https://zhuanlan.zhihu.com/p/376225566)
12. [https://zhuanlan.zhihu.com/p/307892677](https://zhuanlan.zhihu.com/p/307892677)
13. [https://zhuanlan.zhihu.com/p/187273765](https://zhuanlan.zhihu.com/p/187273765)
14. [https://zhuanlan.zhihu.com/p/437555266](https://zhuanlan.zhihu.com/p/437555266)
15. [https://www.blockvalue.com/news/20200212196663.html](https://www.blockvalue.com/news/20200212196663.html)